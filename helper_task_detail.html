<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SwaDrive | Task Details</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;600;700&family=Poppins:wght@400;500&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
:root{
  --primary:#4776E6;
  --gradient:linear-gradient(135deg,#4776E6,#8E54E9);
  --text:#2D3748;
  --muted:#718096;
  --bg:#F7FAFC;
  --card:#ffffff;
  --radius:14px;
  --shadow:0 10px 30px rgba(71,118,230,.15);
}

*{box-sizing:border-box;margin:0;padding:0}
body{
  font-family:'Poppins',sans-serif;
  background:var(--bg);
  color:var(--text);
}

/* ---------- NAVBAR ---------- */
.navbar{
  background:#fff;
  padding:16px 30px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  box-shadow:0 2px 10px rgba(0,0,0,.05);
}
.logo{
  font-family:'Montserrat',sans-serif;
  font-size:1.4rem;
  font-weight:700;
  text-decoration:none;
  color:var(--text);
}
.logo span{
  background:var(--gradient);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
}

/* ---------- CONTAINER ---------- */
.container{
  max-width:1100px;
  margin:30px auto;
  padding:0 20px;
}

/* ---------- CARD ---------- */
.card{
  background:var(--card);
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  overflow:hidden;
}

/* ---------- HEADER ---------- */
.card-header{
  background:var(--gradient);
  color:#fff;
  padding:25px 30px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.card-header h1{
  font-size:1.6rem;
  font-family:'Montserrat',sans-serif;
}
.status{
  background:rgba(255,255,255,.2);
  padding:6px 14px;
  border-radius:20px;
  font-size:.75rem;
  font-weight:600;
}

/* ---------- CONTENT ---------- */
.card-body{
  padding:30px;
}
.section{
  margin-bottom:25px;
}
.section-title{
  font-family:'Montserrat',sans-serif;
  font-size:1.1rem;
  margin-bottom:12px;
  display:flex;
  align-items:center;
  gap:10px;
}
.section-title i{color:var(--primary)}
.row{
  display:flex;
  margin-bottom:10px;
}
.label{
  width:150px;
  color:var(--muted);
  font-weight:500;
}
.value{
  flex:1;
}

/* ---------- DESCRIPTION ---------- */
.description{
  background:#f1f5f9;
  padding:20px;
  border-radius:10px;
}

/* ---------- MAP ---------- */
.map{
  margin-top:15px;
  height:260px;
  border-radius:12px;
  overflow:hidden;
}
iframe{
  width:100%;
  height:100%;
  border:0;
}

/* ---------- BUTTONS ---------- */
.actions{
  display:flex;
  gap:15px;
  margin-top:30px;
  flex-wrap:wrap;
}
.btn{
  padding:12px 26px;
  border:none;
  border-radius:40px;
  font-family:'Montserrat',sans-serif;
  font-weight:600;
  cursor:pointer;
  display:flex;
  align-items:center;
  gap:8px;
}
.btn-primary{
  background:var(--gradient);
  color:#fff;
}
.btn-outline{
  background:#fff;
  border:1px solid #ddd;
  color:var(--text);
}
.btn:hover{opacity:.9}

/* ---------- MOBILE ---------- */
@media(max-width:768px){
  .row{flex-direction:column}
  .label{width:auto;margin-bottom:4px}
  .card-header h1{font-size:1.3rem}
}
</style>
</head>

<body>

<nav class="navbar">
  <a href="tasks.html" class="logo">Swa<span>Drive</span></a>
</nav>

<div class="container">
  <div class="card">

    <div class="card-header">
      <h1 id="title">Loading...</h1>
      <div class="status" id="status">OPEN</div>
    </div>

    <div class="card-body">

      <div class="section">
        <div class="row"><div class="label">Urgency</div><div class="value" id="urgency">-</div></div>
        <div class="row"><div class="label">Reward</div><div class="value">‚Çπ <span id="reward">0</span></div></div>
      </div>

      <div class="section">
        <div class="section-title"><i class="fas fa-align-left"></i>Description</div>
        <div class="description" id="description">-</div>
      </div>

      <div class="section">
        <div class="section-title"><i class="fas fa-map-marker-alt"></i>Location</div>
        <div class="row"><div class="label">Address</div><div class="value" id="location">-</div></div>
        <div class="map">
          <iframe id="map"></iframe>
        </div>
      </div>

      <div class="actions">
        <button class="btn btn-outline" onclick="history.back()">
          <i class="fas fa-arrow-left"></i> Back
        </button>
        <button class="btn btn-primary" onclick="acceptTask()">
          <i class="fas fa-check"></i> Accept Task
        </button>
       <button class="btn btn-primary" onclick="completeTask(taskId)">
  <i class="fas fa-check-circle"></i> Mark Completed
</button>

      </div>

    </div>
  </div>
</div>

<script>
const BACKEND_URL="https://swadrive-backend.onrender.com";
const token=localStorage.getItem("token");
const params=new URLSearchParams(window.location.search);
const taskId=params.get("task_id");

if(!token){alert("Login first");location.href="login.html"}
if(!taskId){alert("Task id missing")}

async function loadTask(){
  const res=await fetch(`${BACKEND_URL}/api/helper/tasks/${taskId}`,{
    headers:{Authorization:"Bearer "+token}
  });
  if(!res.ok){alert("Failed to load task");return;}
  const t=await res.json();

  title.textContent=t.title;
  status.textContent=(t.status||"open").toUpperCase();
  urgency.textContent=t.urgency||"-";
  reward.textContent=t.reward_amount||0;
  description.textContent=t.description||"-";
  location.textContent=t.location||"-";

  if(t.location){
    map.src=`https://www.google.com/maps?q=${encodeURIComponent(t.location)}&output=embed`;
  }
}
  

  
async function acceptTask(){
  if(!confirm("Accept this task?"))return;
  const res=await fetch(`${BACKEND_URL}/api/tasks/${taskId}/accept`,{
    method:"POST",
    headers:{Authorization:"Bearer "+token}
  });
  const data=await res.json();
  if(!res.ok){alert(data.message||"Failed");return;}
  alert("Task accepted ‚úÖ");
  location.href="tasks.html";
}

loadTask();

  async function completeTask(taskId) {
  if (!confirm("‚úÖ Are you sure you completed this task?")) return;

  const token = localStorage.getItem("token");
  if (!token) {
    alert("Login first");
    location.href = "login.html";
    return;
  }

  try {
    const res = await fetch(
      `${BACKEND_URL}/api/tasks/${taskId}/complete`,
      {
        method: "POST",
        headers: {
          Authorization: "Bearer " + token
        }
      }
    );

    const data = await res.json();

    if (!res.ok) {
      alert("‚ùå " + data.message);
      return;
    }

    alert("üéâ Task completed!");
    location.href = "helper_my_tasks.html";

  } catch (err) {
    alert("‚ùå Network error");
  }
}

</script>

</body>
</html>


